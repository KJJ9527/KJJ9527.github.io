<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.12.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="柯建军的博客">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="柯建军的博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="柯建军">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>柯建军的博客</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">柯建军的博客</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-首页"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-标签"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-分类"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-归档"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-资源"><a href="/resource/" rel="section"><i class="fa fa-download fa-fw fa-fw"></i>资源</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="柯建军"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">柯建军</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">42</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/KJJ9527" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;KJJ9527" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:963707772@qq.com" title="E-Mail → mailto:963707772@qq.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/08/03/20%E5%88%86%E9%92%9F%E5%AD%A6%E4%BC%9ATypeScript/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="柯建军">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="柯建军的博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 柯建军的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/08/03/20%E5%88%86%E9%92%9F%E5%AD%A6%E4%BC%9ATypeScript/" class="post-title-link" itemprop="url">20分钟学会TypeScript</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-08-03 20:50:23" itemprop="dateCreated datePublished" datetime="2023-08-03T20:50:23+08:00">2023-08-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-08-04 00:22:04" itemprop="dateModified" datetime="2023-08-04T00:22:04+08:00">2023-08-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/TypeScript/" itemprop="url" rel="index"><span itemprop="name">TypeScript</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>3.5k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>3 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>TypeScript已经成为前端必备技能了，以下是TypeScript的优势</p>
<ol>
<li>静态类型检查：TypeScript是JavaScript的超集，它引入了静态类型检查，可以在编译时发现类型错误，减少在运行时出现的错误。这可以提高代码的可靠性和维护性。</li>
<li>更好的开发工具支持：TypeScript提供了更好的开发工具支持，如代码自动补全、代码导航、重构和调试等功能。这些工具可以提高开发效率，并减少调试和排错的时间。</li>
<li>更好的代码组织和重用：TypeScript支持面向对象的编程风格，可以使用类、接口、模块等概念来组织和重用代码。这有助于提高代码的可读性、可维护性和可扩展性。</li>
<li>更好的团队协作：TypeScript的静态类型检查可以帮助团队成员更好地理解和使用代码，减少因为类型错误导致的沟通和协作问题。此外，TypeScript还支持定义类型声明文件，可以提供给其他团队成员使用，减少对代码的依赖和理解成本。</li>
<li>兼容性和迁移性：TypeScript兼容JavaScript的语法和库，可以无缝地集成到现有的JavaScript项目中。此外，TypeScript还提供了一些工具和指南，可以帮助开发者将现有的JavaScript代码逐步迁移到TypeScript。</li>
</ol>
<h3 id="开始使用TypeScript"><a href="#开始使用TypeScript" class="headerlink" title="开始使用TypeScript"></a>开始使用TypeScript</h3><p>在项目中安装TypeScript</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i typescript -g</span><br></pre></td></tr></table></figure>
<p>在TypeScript官网打开演练场<br><a target="_blank" rel="noopener" href="https://www.typescriptlang.org/zh/">TypeScript官网</a></p>
<h3 id="类型推断"><a href="#类型推断" class="headerlink" title="类型推断"></a>类型推断</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="keyword">let</span> str = <span class="string">&#x27;abc&#x27;</span></span><br><span class="line">str = <span class="number">10</span></span><br><span class="line"><span class="comment">// typescript会根据你给变量存放的初始值来进行变量类型限定，这在我们开发中很有意义，因为变量一旦分配了字符串值，那意味着后期可能会书写一些字符串相关功能，比如方法等相关的操作，如果过程中突然分配了一个数值，那意味着这些针对字符串的操作都是会出现错误的，为了避免这些情况，我们才需要使用TypeScript</span></span><br></pre></td></tr></table></figure>
<h3 id="类型注解"><a href="#类型注解" class="headerlink" title="类型注解"></a>类型注解</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">str</span>:<span class="built_in">string</span> = <span class="string">&#x27;abc&#x27;</span> || <span class="keyword">let</span> <span class="attr">str</span>:<span class="built_in">string</span>  str = <span class="string">&#x27;abc&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="类型断言"><a href="#类型断言" class="headerlink" title="类型断言"></a>类型断言</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="keyword">let</span> numArr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line"><span class="comment">// find() 方法返回数组中满足提供的测试函数的第一个元素的值。否则返回 undefined。</span></span><br><span class="line"><span class="keyword">const</span> result = numArr.<span class="title function_">find</span>(<span class="function"><span class="params">item</span> =&gt;</span> <span class="number">2</span>)</span><br><span class="line">result * <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 假如我们确定result的最终的结果是必然有值大于2的，那我们就可以通过类型断言的方式来设置</span></span><br><span class="line"><span class="comment">// good</span></span><br><span class="line"><span class="keyword">let</span> numArr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line"><span class="keyword">const</span> result = numArr.<span class="title function_">find</span>(<span class="function"><span class="params">item</span> =&gt;</span> <span class="number">2</span>) <span class="keyword">as</span> <span class="built_in">number</span></span><br><span class="line">result * <span class="number">5</span></span><br></pre></td></tr></table></figure>
<h3 id="基础类型和联合类型"><a href="#基础类型和联合类型" class="headerlink" title="基础类型和联合类型"></a>基础类型和联合类型</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">v1</span>: <span class="built_in">string</span> = <span class="string">&#x27;abc&#x27;</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">v2</span>:<span class="built_in">number</span> = <span class="number">10</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">v3</span>:<span class="built_in">boolean</span> = <span class="literal">true</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">nu</span>:<span class="literal">null</span> = <span class="literal">null</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">un</span>:<span class="literal">undefined</span> = <span class="literal">undefined</span></span><br><span class="line"><span class="comment">// 大家可能比较好奇，null和undefined不常用，为什么还要有，那是因为TypeScript还支持一种类型：联合类型</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">v4</span>:<span class="built_in">string</span> | <span class="literal">null</span> = <span class="literal">null</span></span><br><span class="line"><span class="comment">// null默认是可以分配给其他任意类型的，当我们勾选strictNullChecks时，我们就不能随意将null分配给其他类型</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 我们除了可以限制一些类型以外，还可以做一些具体值的限定</span></span><br><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">v5</span>: <span class="number">1</span> | <span class="number">2</span> | <span class="number">3</span> = <span class="number">5</span></span><br><span class="line"><span class="comment">// good</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">v5</span>: <span class="number">1</span> | <span class="number">2</span> | <span class="number">3</span> = <span class="number">2</span></span><br></pre></td></tr></table></figure>
<h3 id="数组、元组、枚举"><a href="#数组、元组、枚举" class="headerlink" title="数组、元组、枚举"></a>数组、元组、枚举</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数组</span></span><br><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">arr</span>:<span class="built_in">number</span>[] = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="string">&#x27;a&#x27;</span>]</span><br><span class="line"><span class="comment">// good</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">arr</span>:<span class="built_in">number</span>[] = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line"><span class="comment">// good</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">arr1</span>: <span class="title class_">Array</span>&lt;<span class="built_in">string</span>&gt; = [<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 元组</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">t1</span>:[<span class="built_in">number</span>,<span class="built_in">string</span>,<span class="built_in">number</span>] = [<span class="number">1</span>,<span class="string">&#x27;a&#x27;</span>,<span class="number">2</span>]</span><br><span class="line"><span class="comment">// bad</span></span><br><span class="line">t1[<span class="number">0</span>] = <span class="string">&#x27;a&#x27;</span></span><br><span class="line"><span class="comment">// 其实在操作的时候，这个元组并不是说完全必须得是三个值，如果希望某个值可选得话，你也可以采用一个&#x27;?&#x27;的方式来写一个可选参数</span></span><br><span class="line"><span class="comment">// good</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">t1</span>:[<span class="built_in">number</span>,<span class="built_in">string</span>,<span class="built_in">number</span>?] = [<span class="number">1</span>,<span class="string">&#x27;a&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 枚举</span></span><br><span class="line"><span class="comment">// 枚举需要使用一个新的关键字叫 enum[ɪˌnjuːm]，一般枚举首字母大写</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">MyEnum</span> &#123;</span><br><span class="line">	A,</span><br><span class="line">	B,</span><br><span class="line">	C</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 这里我们可以使用两种方式来操作,第一种方式我们可以使用:&#x27;MyEnum.A&#x27;，或者我们可以利用值的方式来访问枚举类型:&#x27;MyEnum[0]&#x27;，枚举类型当我们声明好以后它是会自动做值的分配，默认是从0分配，a是0，b是1，c是2</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">MyEnum</span>.<span class="property">A</span>)	<span class="comment">//0</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">MyEnum</span>[<span class="number">0</span>])	<span class="comment">//A</span></span><br></pre></td></tr></table></figure>
<h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//void类型，void其实就是空的意思，void只能被分配undefined(严格模式)，一般我们很少会给变量去赋值void，通常是一个函数，比如一个函数没有返回值的时候，默认返回undefined</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">myfn</span>(<span class="params">a:<span class="built_in">number</span>,b:<span class="built_in">string</span></span>):<span class="built_in">void</span> &#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(a+b)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 除了可以这样写以外，还有一些其他用法，比如可以把这些参数设置成可选的参数，这和我们使用的ES6是比较类似的，所有的可选参数应该在必选参数的后面</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">myfn</span>(<span class="params">a:<span class="built_in">number</span>,b?:<span class="built_in">string</span></span>):<span class="built_in">void</span> &#123;</span><br><span class="line">	<span class="keyword">if</span>(b) &#123;</span><br><span class="line">		<span class="variable language_">console</span>.<span class="title function_">log</span>(a+b)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="variable language_">console</span>.<span class="title function_">log</span>(a)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 注意&#x27;?&#x27;这种写法只能在TypeScript使用</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 除此之外，也可以将参数设置默认值，设置剩余参数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">myfn</span>(<span class="params">a:<span class="built_in">number</span> = <span class="number">10</span>,b:<span class="built_in">string</span>,c?:<span class="built_in">boolean</span>,...rest:<span class="built_in">number</span>[]</span>):<span class="built_in">void</span> &#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(a+b)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="title function_">myfn</span>(<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</span><br><span class="line"><span class="comment">// good</span></span><br><span class="line"><span class="title function_">myfn</span>(<span class="number">5</span>,<span class="string">&#x27;6&#x27;</span>,<span class="literal">true</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</span><br></pre></td></tr></table></figure>
<h3 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 接口的关键字是&#x27;interface&#x27;，通常用来去进行一个对象的定义</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Obj</span> &#123;</span><br><span class="line">	<span class="attr">name</span>:<span class="built_in">string</span>,</span><br><span class="line">	<span class="attr">age</span>:<span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="attr">obj</span>:<span class="title class_">Obj</span> = &#123;</span><br><span class="line">	<span class="attr">name</span>:<span class="string">&#x27;a&#x27;</span>,</span><br><span class="line">	<span class="attr">age</span>:<span class="number">10</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 这种方式就避免在声明数据的时候出现一些偏差</span></span><br></pre></td></tr></table></figure>
<h3 id="类型别名"><a href="#类型别名" class="headerlink" title="类型别名"></a>类型别名</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 比如需要定义几个用户名变量，可能是联合类型</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">a</span>: <span class="built_in">string</span> | <span class="built_in">number</span> = <span class="number">10</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">b</span>: <span class="built_in">string</span> | <span class="built_in">number</span> = <span class="number">20</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">c</span>: <span class="built_in">string</span> | <span class="built_in">number</span> = <span class="string">&#x27;abc&#x27;</span></span><br><span class="line"><span class="comment">//使用类型别名，类型别名关键字&#x27;type&#x27;</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">MyUserName</span> = <span class="built_in">string</span> | <span class="built_in">number</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">a</span>: <span class="title class_">MyUserName</span> = <span class="number">10</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">b</span>: <span class="title class_">MyUserName</span> = <span class="number">20</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">c</span>: <span class="title class_">MyUserName</span> = <span class="string">&#x27;abc&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="泛型"><a href="#泛型" class="headerlink" title="泛型"></a>泛型</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">myFn</span>(<span class="params">a:<span class="built_in">number</span>,b:<span class="built_in">number</span></span>):<span class="built_in">number</span>[] &#123;</span><br><span class="line">	<span class="keyword">return</span> [a,b]</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 假设这个函数是一个比较通用的函数，既可以处理数字值，又可以处理字符串值，布尔值等等，这种情况下，想用它来传其他类型数据，就不可以了，因为它规定的是number，那有没有可能写number | string呢？那样的话会出现交叉使用的情况，为了避免这个问题，就可以采用泛型的概念</span></span><br><span class="line"><span class="keyword">function</span> myFn&lt;T&gt;(<span class="attr">a</span>:T,<span class="attr">b</span>:T):T[] &#123;</span><br><span class="line">	<span class="keyword">return</span> [a,b]</span><br><span class="line">&#125;</span><br><span class="line">myFn&lt;<span class="built_in">number</span>&gt;(<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line">myFn&lt;<span class="built_in">string</span>&gt;(<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>) || <span class="title function_">myFn</span>(<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>)</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/07/01/%E5%BC%82%E6%AD%A5%E4%B8%8EPromise/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="柯建军">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="柯建军的博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 柯建军的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/07/01/%E5%BC%82%E6%AD%A5%E4%B8%8EPromise/" class="post-title-link" itemprop="url">异步与Promise</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-07-01 23:26:59" itemprop="dateCreated datePublished" datetime="2023-07-01T23:26:59+08:00">2023-07-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-07-02 11:56:56" itemprop="dateModified" datetime="2023-07-02T11:56:56+08:00">2023-07-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/JS/" itemprop="url" rel="index"><span itemprop="name">JS</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>4.5k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>4 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="JS异步的概念"><a href="#JS异步的概念" class="headerlink" title="JS异步的概念"></a>JS异步的概念</h2><p>我们的JS程序几乎是由多个块(函数)构成的，这些块中只有一个是现在执行，其余的则会在将来执行</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// A</span></span><br><span class="line"><span class="title function_">ajax</span>(<span class="string">&quot;..&quot;</span>,<span class="keyword">function</span>(<span class="params">..</span>) &#123;</span><br><span class="line">	<span class="comment">//C</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// B</span></span><br></pre></td></tr></table></figure>
<p>&#x2F;&#x2F; A 和 &#x2F;&#x2F; B 表示程序的前半部分(也就是现在的部分)，而&#x2F;&#x2F; C 标识了程序的后半部分(也就是将来的部分)。前半部分立刻执行，然后是一段时间不确定的停顿。在未来的某个时刻，如果Ajax调用完成，程序就会从停下的位置继续执行后半部分，这个ajax函数就是异步函数。</p>
<h3 id="事件循环"><a href="#事件循环" class="headerlink" title="事件循环"></a>事件循环</h3><p>举例来说，如果你的JavaScript程序发出一个Ajax请求，从服务器获取一些数据，那你就在一个函数(通常称为回调函数)中设置好响应代码，然后JavaScript引擎会通知宿主环境(对多数开发者来说通常就是Web浏览器)：“嘿，现在我要暂停执行，你一旦完成网络请求，拿到了数据，就请调用这个函数”。然后浏览器就会设置侦听来自网络的响应，拿到要给你的数据之后，就会把回调函数插入到事件循环，以此实现对这个回调的调度执行<br>那么，什么是事件循环？<br>先通过一段伪代码了解一下这个概念：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// eventLoop是一个用作队列的数组</span></span><br><span class="line"><span class="comment">// (先进，先出)</span></span><br><span class="line"><span class="keyword">let</span> eventLoop = [];</span><br><span class="line"><span class="keyword">let</span> event;</span><br><span class="line"></span><br><span class="line"><span class="comment">// “永远”执行</span></span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="comment">// 一次tick</span></span><br><span class="line">    <span class="keyword">if</span>(eventLoop.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// 拿到队列中的下一个事件</span></span><br><span class="line">        event = eventLoop.<span class="title function_">shift</span>();</span><br><span class="line">        <span class="comment">// 现在，执行下一个事件</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="title function_">event</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">            <span class="title function_">reportError</span>(err);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>一定要清楚，setTimeout(..)并没有把你的回调函数挂在事件循环队列中。它所做的是设定一个定时器。当定时器到时后，环境(对多数开发者来说通常就是Web浏览器)会把你的回调函数放在事件循环中，这样，在未来某个时刻的tick会摘下并执行这个回调。</p>
<h3 id="回调地狱"><a href="#回调地狱" class="headerlink" title="回调地狱"></a>回调地狱</h3><p>现在来看一段代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">drive</span>(<span class="params">fn, timer</span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(fn, timer);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">play</span>(<span class="params">fn, timer</span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(fn, timer);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">dinner</span>(<span class="params">fn, timer</span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(fn, timer);</span><br><span class="line">&#125;</span><br><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">drive</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;正在开车去商场&quot;</span>);	<span class="comment">// A</span></span><br><span class="line">    &#125;, <span class="number">3000</span>);</span><br><span class="line">    <span class="title function_">play</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;正在商场玩&quot;</span>);		<span class="comment">// B</span></span><br><span class="line">    &#125;, <span class="number">2000</span>);</span><br><span class="line">    <span class="title function_">dinner</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;正在商场吃晚餐&quot;</span>);	<span class="comment">// C</span></span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 我们希望代码依次按照A,B,C的顺序执行</span></span><br><span class="line"><span class="comment">// 实际上输出顺序C,B,A</span></span><br></pre></td></tr></table></figure>
<p>上述代码输出结果与预期不符是因为setTimeout是异步函数，根据事件循环队列先进先出的原则，它会依次执行C,B,A函数的回调函数</p>
<p>使用回调函数调整异步函数执行顺序</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">drive</span>(<span class="params">fn, timer</span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(fn, timer);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">play</span>(<span class="params">fn, timer</span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(fn, timer);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">dinner</span>(<span class="params">fn, timer</span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(fn, timer);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">drive</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;正在开车去商场&quot;</span>);	<span class="comment">// A</span></span><br><span class="line">        <span class="title function_">play</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;正在商场玩&quot;</span>);	<span class="comment">// B</span></span><br><span class="line">            <span class="title function_">dinner</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;正在商场吃晚餐&quot;</span>);	<span class="comment">// C</span></span><br><span class="line">            &#125;, <span class="number">1000</span>);</span><br><span class="line">        &#125;, <span class="number">2000</span>);</span><br><span class="line">    &#125;, <span class="number">3000</span>);</span><br><span class="line">&#125;)();</span><br><span class="line"><span class="comment">// 此时输出顺序为A,B,C</span></span><br></pre></td></tr></table></figure>
<p>这里我们得到了三个函数嵌套在一起构成的链，其中每个函数代表异步序列(任务，”进程”)中的一个步骤<br>这种代码常常被称为回调地狱(callback hell)，有时也被称为毁灭金字塔(pyramid of doom，得名于嵌套缩进产生的横向三角形状)<br>很显然，这种代码是复杂和难以阅读维护的，于是Promise出现了</p>
<h3 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h3><p>所谓Promise，简单说就是一个容器，里面保存着某个未来才会结束的事件(通常是一个异步操作)的结果。从语法上说，Promise是一个对象(广义)，从它可以获取异步操作的消息。Promise提供统一的API，各种异步操作都可以用同样的方法进行处理<br>Promiese对象有以下两个特点<br>(1)对象的状态不受外界影响。Promise对象代表一个异步操作，有三种状态：pending（进行中）、fulfilled（已成功）和rejected（已失败）。只有异步操作的结果，可以决定当前是哪一种状态，任何其他操作都无法改变这个状态。这也是Promise这个名字的由来，它的英语意思就是“承诺”，表示其他手段无法改变。<br>(2)一旦状态改变，就不会再变，任何时候都可以得到这个结果。Promise对象的状态改变，只有两种可能：从pending变为fulfilled和从pending变为rejected。只要这两种情况发生，状态就凝固了，不会再变了，会一直保持这个结果，这时就称为 resolved（已定型）。如果改变已经发生了，你再对Promise对象添加回调函数，也会立即得到这个结果。这与事件（Event）完全不同，事件的特点是，如果你错过了它，再去监听，是得不到结果的。<br>ES6规定，Promise对象是一个构造函数，用来生成Promise实例<br>现在来看一段Promise代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;我是同步代码A&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> drive = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;我是drive Promise里的代码&quot;</span>);</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">resolve</span>(<span class="string">&quot;正在开车去商场&quot;</span>);</span><br><span class="line">    &#125;, <span class="number">3000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> play = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;我是play Promise里的代码&quot;</span>);</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">resolve</span>(<span class="string">&quot;正在商场玩&quot;</span>);</span><br><span class="line">    &#125;, <span class="number">2000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> dinner = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;我是dinner Promise里的代码&quot;</span>);</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">resolve</span>(<span class="string">&quot;正在商场吃晚餐&quot;</span>);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line">drive</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">    <span class="keyword">return</span> play;</span><br><span class="line">&#125;)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">    <span class="keyword">return</span> dinner;</span><br><span class="line">&#125;)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;我是同步代码B&quot;</span>);</span><br><span class="line"><span class="comment">// 输出结果:</span></span><br><span class="line"><span class="comment">// 我是同步代码A</span></span><br><span class="line"><span class="comment">// 我是drive Promise里的代码</span></span><br><span class="line"><span class="comment">// 我是play Promise里的代码</span></span><br><span class="line"><span class="comment">// 我是dinner Promise里的代码</span></span><br><span class="line"><span class="comment">// 我是同步代码B</span></span><br><span class="line"><span class="comment">// 正在开车去商场</span></span><br><span class="line"><span class="comment">// 正在商场玩</span></span><br><span class="line"><span class="comment">// 正在商场吃晚餐</span></span><br></pre></td></tr></table></figure>
<p>上面代码中，Promise新建后立即执行，所以首先输出的是 Promise里的代码。然后，then方法指定的回调函数，将在当前脚本所有同步任务执行完才会执行，所以 正在开车去商场…最后输出</p>
<p>有了Promise对象，就可以将异步操作以同步操作的流程表达出来，避免了层层嵌套的回调函数。此外，Promise对象提供统一的接口，使得控制异步操作更加容易。<br>Promise构造函数接受一个函数作为参数，该函数的两个参数分别是resolve（异步操作成功时调用）和reject(异步操作失败时调用)。它们是两个函数，由 JavaScript 引擎提供，不用自己部署。<br>了解：<br>Promise也有一些缺点。首先，无法取消Promise，一旦新建它就会立即执行，无法中途取消。其次，如果不设置回调函数，Promise内部抛出的错误，不会反应到外部。第三，当处于pending状态时，无法得知目前进展到哪一个阶段(刚刚开始还是即将完成)</p>
<h3 id="async-await"><a href="#async-await" class="headerlink" title="async await"></a>async await</h3><p>ES2017标准引入了async函数，使得异步操作变得更加方便。<br>async函数是什么？一句话，它就是Generator函数的语法糖<br>async函数返回一个 Promise 对象，可以使用then方法添加回调函数。当函数执行的时候，一旦遇到await就会先返回，等到异步操作完成，再接着执行函数体内后面的语句。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">drive</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;正在开车去商场&quot;</span>);</span><br><span class="line">    &#125;, <span class="number">3000</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">play</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;正在商场玩&quot;</span>);</span><br><span class="line">    &#125;, <span class="number">2000</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">dinner</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;正在商场吃晚餐&quot;</span>);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line">(<span class="keyword">async</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">drive</span>();</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">play</span>();</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">dinner</span>();</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>




      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/07/01/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%81%8C%E4%B8%9A%E8%A7%84%E5%88%92/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="柯建军">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="柯建军的博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 柯建军的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/07/01/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%81%8C%E4%B8%9A%E8%A7%84%E5%88%92/" class="post-title-link" itemprop="url">程序员的职业规划</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2023-07-01 10:23:58 / 修改时间：12:45:40" itemprop="dateCreated datePublished" datetime="2023-07-01T10:23:58+08:00">2023-07-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%81%8C%E4%B8%9A%E8%A7%84%E5%88%92/" itemprop="url" rel="index"><span itemprop="name">职业规划</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>693</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>这两天在b站刷视频，偶然看到了一位阿里P8的程序员，叫徐赫老师。他分享了一些程序员职业规划的话题，我觉得这个话题很有意义，无论是什么行业，职业规划都是很有必要的。在这里大概记录一下徐赫老师所说的话题。<br>徐赫老师主要分享的两个话题，一：程序员如何更好的工作；二：程序员晋升需要注意什么</p>
<h3 id="程序员如何更好的工作"><a href="#程序员如何更好的工作" class="headerlink" title="程序员如何更好的工作"></a>程序员如何更好的工作</h3><p>这里主要分为三个阶段<br>1-3年阶段<br>关键词：折腾<br>1~3年是打基础的阶段，要不断折腾。主动学习市面主流技术，了解同样的语言和工具，多刨根问底，了解一下原理，提高自身的核心竞争力。如果只是一知半解，那么永远只是一个初级水平。</p>
<p>3-5年<br>关键词：沉淀<br>3~5年要对自己工作做一些提效，多思考。如何更快速和更好的去完成crud，提高工作效率。</p>
<p>5-10年<br>关键词：优秀<br>5~10年要以终为始，让自己成为一个优秀的人。优秀不是标准，它是一个比例，不是说跑步要跑进多少秒，而是要比别人跑得更快。如果团队别人都不写周报，那么就要尝试去写周报，因为你比别人做得更好。如果大家都写周报，那就把周报写得更好。代码如何写得更好，文档如何写得更好，沟通如何做到更好。要知止，要知道自己的目标是什么，只有知道自己的目标是什么，才能比别人做得更好。</p>
<h3 id="程序员晋升需要注意什么"><a href="#程序员晋升需要注意什么" class="headerlink" title="程序员晋升需要注意什么"></a>程序员晋升需要注意什么</h3><p>一：始终要保持积累沉淀和终身学习的一个状态<br>二：练能力，涨本事<br>能力和本事是两回事，能力是具备的基本素质，本事是解决问题的能力。 以能力来看，十个刘邦都不一定打得过项羽，所以项羽是一个有能力的人，但是刘邦是有本事的人。所以技术能力极强，但是不能给企业和业务和公司带来效益，带来价值，那其实用处不大。<br>三：坚持<br>坚持学习，坚持优秀，坚持终身学习的这种心态<br>四：拓宽自己的人脉</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/05/30/%E6%B7%B1%E6%8B%B7%E8%B4%9D%E5%92%8C%E6%B5%85%E6%8B%B7%E8%B4%9D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="柯建军">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="柯建军的博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 柯建军的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/05/30/%E6%B7%B1%E6%8B%B7%E8%B4%9D%E5%92%8C%E6%B5%85%E6%8B%B7%E8%B4%9D/" class="post-title-link" itemprop="url">深拷贝和浅拷贝</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-05-30 22:31:47" itemprop="dateCreated datePublished" datetime="2023-05-30T22:31:47+08:00">2023-05-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-31 00:39:23" itemprop="dateModified" datetime="2023-05-31T00:39:23+08:00">2023-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/JS/" itemprop="url" rel="index"><span itemprop="name">JS</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>698</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="数据类型概述"><a href="#数据类型概述" class="headerlink" title="数据类型概述"></a>数据类型概述</h2><h3 id="基本的数据类型"><a href="#基本的数据类型" class="headerlink" title="基本的数据类型"></a>基本的数据类型</h3><p>数值(number)，字符串(string)，布尔值(boolean)<br>至于undefined和null，一般将它们看成两个特殊值</p>
<h3 id="复杂的数据类型"><a href="#复杂的数据类型" class="headerlink" title="复杂的数据类型"></a>复杂的数据类型</h3><p>对象是最复杂的数据类型，又可以分为三个子类型</p>
<ul>
<li>狭义的对象(object)</li>
<li>数组(array)</li>
<li>函数(function)</li>
</ul>
<h2 id="基本数据类型的拷贝"><a href="#基本数据类型的拷贝" class="headerlink" title="基本数据类型的拷贝"></a>基本数据类型的拷贝</h2><p>基本数据类型的值是存入栈内存中的。值与值之间是相互独立存在的，当我们改变了a的值，对b是没有影响的，所以b输出的还是10</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">let</span> b = a;</span><br><span class="line">a = <span class="number">100</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a);	<span class="comment">// 100</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(b);	<span class="comment">// 10</span></span><br></pre></td></tr></table></figure>


<h2 id="复杂的数据类型拷贝-引用数据类型"><a href="#复杂的数据类型拷贝-引用数据类型" class="headerlink" title="复杂的数据类型拷贝(引用数据类型)"></a>复杂的数据类型拷贝(引用数据类型)</h2><p>引用数据类型的值是存入堆内存中的，变量a存的是一个对象的内存地址(对象的引用)，所以只是把a的内存地址赋值给b，如果两个变量保存的是同一个内存地址(对象的引用)，每当通过修改任意一个变量修改属性时，另一个也会受到影响</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = &#123;</span><br><span class="line"><span class="attr">age</span>: <span class="number">10</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> b = a;</span><br><span class="line">a.<span class="property">age</span> = <span class="number">100</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a.<span class="property">age</span>);	<span class="comment">// 100</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(b.<span class="property">age</span>);	<span class="comment">// 100</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line"><span class="keyword">let</span> b = a</span><br><span class="line">a[<span class="number">0</span>] = <span class="number">100</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a)	<span class="comment">// [100, 2, 3]</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(b)	<span class="comment">// [100, 2, 3]</span></span><br></pre></td></tr></table></figure>
<h2 id="深拷贝"><a href="#深拷贝" class="headerlink" title="深拷贝"></a>深拷贝</h2><p>如果是基本的数据类型，那么它们之间的拷贝都是深拷贝。如果是引用数据类型，只要把内部的引用类型数据全部都独立开一块内存空间，让它们之间完全不要有共用，数据完全相互不干扰就是深拷贝</p>
<h2 id="浅拷贝"><a href="#浅拷贝" class="headerlink" title="浅拷贝"></a>浅拷贝</h2><p>只要内部的引用类型数据有共用，数据会相互干扰就是浅拷贝</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/04/26/Git/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="柯建军">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="柯建军的博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 柯建军的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/04/26/Git/" class="post-title-link" itemprop="url">Git</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-04-26 19:36:51" itemprop="dateCreated datePublished" datetime="2023-04-26T19:36:51+08:00">2023-04-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-10-19 20:56:04" itemprop="dateModified" datetime="2023-10-19T20:56:04+08:00">2023-10-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/git/" itemprop="url" rel="index"><span itemprop="name">git</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2.7k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="Git"><a href="#Git" class="headerlink" title="Git"></a>Git</h2><h3 id="git分支命名规范"><a href="#git分支命名规范" class="headerlink" title="git分支命名规范"></a>git分支命名规范</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// feat: 新功能</span><br><span class="line">// perf: 功能优化(performance)</span><br><span class="line">// fix: bug修复</span><br><span class="line">// config: 配置修改,策略调整</span><br><span class="line">// day: 日常提交</span><br><span class="line">// merge: 代码合并: 比如分支同步master最新代码</span><br></pre></td></tr></table></figure>

<h3 id="master分支与其他分支"><a href="#master分支与其他分支" class="headerlink" title="master分支与其他分支"></a>master分支与其他分支</h3><p>主分支master分支用来发布新版本<br>平时代码提交到自己的分支</p>
<p>下载分支</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/... .git	// 下载所有分支代码到本地</span><br><span class="line">git clone -b &lt;branchName&gt; https://github.com/... .git	// 下载指定分支到本地</span><br></pre></td></tr></table></figure>

<p>查看分支</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git branch		// 查看本地分支</span><br><span class="line">git pull		// 更新</span><br><span class="line">git branch -r	// 查看远程所有分支</span><br></pre></td></tr></table></figure>
<p>创建分支</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch &lt;branchName&gt;		// 保存在本地，要在远程创建分支最终需要push</span><br></pre></td></tr></table></figure>
<p>切换分支</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout &lt;branchName&gt;</span><br></pre></td></tr></table></figure>
<p>创建+切换分支</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout -b &lt;branchName&gt;</span><br></pre></td></tr></table></figure>
<p>本地分支关联远程分支</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch --set-upstream-to=origin/&lt;branch&gt;</span><br></pre></td></tr></table></figure>

<p>提交分支</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin &lt;branchName&gt;	// 如果远程没有这个分支，它会自动创建这个分支</span><br></pre></td></tr></table></figure>

<p>取消git add</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// git reset命令可以用来重置暂存区，也可以用来撤销提交</span><br><span class="line">git reset &lt;file&gt;	// 取消单个文件</span><br><span class="line">git reset .		// 取消所有文件的暂存</span><br></pre></td></tr></table></figure>

<p>删除分支</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git branch -d &lt;branchName&gt;		// 删除本地分支</span><br><span class="line">git push origin --delete &lt;branchName&gt;	// 删除远程分支</span><br></pre></td></tr></table></figure>
<p>下载远程指定分支到本地指定分支</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git checkout -b &lt;本地分支名称&gt; origin/&lt;远程分支名称&gt;</span><br><span class="line">// 例如</span><br><span class="line">git checkout -b my-branch origin/feature-branch</span><br></pre></td></tr></table></figure>
<p>更改分支名称</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// 更改本地分支名称</span><br><span class="line">// -M 强制重命名 </span><br><span class="line">git branch -M &lt;old_branch_name&gt; &lt;new_branch_name&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 更改远程分支名称</span><br><span class="line">git push origin :refs/heads/old_branch refs/heads/new_branch</span><br><span class="line">// 例如</span><br><span class="line">git push origin :old_branch new_branch</span><br></pre></td></tr></table></figure>

<p>使用merge命令合并分支</p>
<p>1.1、多人开发，需要将远程代码pull下来</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git pull  origin &lt;branchName&gt;</span><br></pre></td></tr></table></figure>
<p>1.2、合并某分支到当前分支</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Administrator	/d/code/...	(master)	// 当前分支</span><br><span class="line">git merge dev		// 被合并的分支</span><br></pre></td></tr></table></figure>
<p>Git 无法自动合并分支时，必须先解决冲突，再提交，合并完成<br>1.3、查看状态</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git status</span><br></pre></td></tr></table></figure>
<p>1.4、提交</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin</span><br></pre></td></tr></table></figure>
<p>查看分支合并图</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git log --graph</span><br></pre></td></tr></table></figure>

<h3 id="git回退"><a href="#git回退" class="headerlink" title="git回退"></a>git回退</h3><p>当我们出现错误提交的情况时，我们希望能撤销提交操作，让程序回到提交前的样子，这里我们使用回退(reset)<br>git回退版本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reset --hard &lt;目标版本号&gt;</span><br></pre></td></tr></table></figure>
<p>git 强制推送<br>如果用git push 会报错，因为我们本地库HEAD指向的版本比远程库的要旧</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push -f</span><br></pre></td></tr></table></figure>

<h3 id="git错误信息"><a href="#git错误信息" class="headerlink" title="git错误信息"></a>git错误信息</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">husky - pre-commit hook exited with code 1 (error)</span><br></pre></td></tr></table></figure>
<p>chatgpt给出报错原因:<br>这个错误通常与 pre-commit hook 脚本中的问题有关。pre-commit hook 是在提交之前运行的脚本，用于执行一些代码检查、格式化或测试等操作。当 pre-commit hook 脚本返回非零的退出代码时，会触发此错误。<br>要解决这个问题，您可以按照以下步骤进行排查：</p>
<ol>
<li>检查错误消息：查看错误消息中是否有关于错误原因的具体信息。这可能包括脚本的名称、路径、行号等。这些信息可以帮助您定位问题。</li>
<li>检查 pre-commit hook 脚本：打开 pre-commit hook 脚本文件，查看其中是否有错误。可能是脚本语法错误、缺少依赖项或其他问题导致脚本执行失败。确保脚本是可执行的，并且没有任何语法错误。可以尝试在命令行中手动执行该脚本，看是否会出现任何错误。</li>
<li>检查 pre-commit hook 的依赖项：如果 pre-commit hook 脚本依赖于其他工具或库，请确保这些依赖项已正确安装，并且在执行脚本时可以访问到。</li>
<li>检查 Husky 配置：检查您的 Husky 配置文件，如 package.json 或 .husky 目录中的配置文件。确保 pre-commit hook 的配置正确无误。检查 hooks 部分是否正确设置了 pre-commit hook，并且指向了正确的脚本文件或命令。</li>
<li>检查 Git hooks 目录：检查 Git 仓库中的 hooks 目录，通常是 .git&#x2F;hooks。确保 pre-commit hook 脚本位于这个目录中，并且具有正确的权限。如果您使用了 Husky，它会自动将 pre-commit hook 脚本复制到 .git&#x2F;hooks 目录中。确保脚本存在于正确的位置，并且可以执行。</li>
</ol>
<h3 id="绕过钩子脚本"><a href="#绕过钩子脚本" class="headerlink" title="绕过钩子脚本"></a>绕过钩子脚本</h3><p>在 commit时加上 –no-verify参数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit -m &quot;xxx&quot; --no-verif</span><br></pre></td></tr></table></figure>
<h3 id="git-合并多条commit记录"><a href="#git-合并多条commit记录" class="headerlink" title="git 合并多条commit记录"></a>git 合并多条commit记录</h3><p>如图所示，想要合并前面三条记录为一条记录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git rebase -i ...	// 版本号</span><br></pre></td></tr></table></figure>
<p><img src="/2023/04/26/Git/1.png" alt="1"></p>
<p>输入i进入插入模式，将需要被合并的两条记录改为s或squash<br><img src="/2023/04/26/Git/2.png" alt="2"></p>
<p>Esc退出编辑模式，Shift+:，wq保存退出</p>
<p>自定义commit message注释<br><img src="/2023/04/26/Git/3.png" alt="3"><br>输入i进入插入模式，将不需要的提交信息前面加#号注释<br><img src="/2023/04/26/Git/4.png" alt="4"><br>Esc退出编辑模式，Shift+:，wq保存退出</p>
<p>成功合并<br><img src="/2023/04/26/Git/5.png" alt="5"></p>
<p>强制推送到远程分支仓库<br><img src="/2023/04/26/Git/6.png" alt="6"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/04/09/%E9%A1%B9%E7%9B%AE%E4%BC%98%E5%8C%96/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="柯建军">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="柯建军的博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 柯建军的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/04/09/%E9%A1%B9%E7%9B%AE%E4%BC%98%E5%8C%96/" class="post-title-link" itemprop="url">项目优化</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-04-09 20:14:29" itemprop="dateCreated datePublished" datetime="2023-04-09T20:14:29+08:00">2023-04-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-04-10 11:32:27" itemprop="dateModified" datetime="2023-04-10T11:32:27+08:00">2023-04-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/React/" itemprop="url" rel="index"><span itemprop="name">React</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>3.6k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>3 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="项目优化"><a href="#项目优化" class="headerlink" title="项目优化"></a>项目优化</h2><h3 id="项目打包以及本地预览"><a href="#项目打包以及本地预览" class="headerlink" title="项目打包以及本地预览"></a>项目打包以及本地预览</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 打包</span></span><br><span class="line">yarn build</span><br><span class="line"><span class="comment">// 本地预览</span></span><br><span class="line"><span class="comment">// 安装全局安装本地服务包 </span></span><br><span class="line">npm i -g serve</span><br><span class="line"><span class="comment">// 或 直接使用 </span></span><br><span class="line">npx serve -s ./build</span><br></pre></td></tr></table></figure>
<h3 id="打包体积分析"><a href="#打包体积分析" class="headerlink" title="打包体积分析"></a>打包体积分析</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 安装分析打包体积的包</span></span><br><span class="line">yarn add source-map-explorer</span><br><span class="line"><span class="comment">// 在package.json中添加一条命令	&quot;anylyze&quot;: &quot;source-map-explorer &#x27;build/static/js/*.js&quot;</span></span><br><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;start&quot;</span>: <span class="string">&quot;craco start&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build&quot;</span>: <span class="string">&quot;craco build&quot;</span>,</span><br><span class="line">    <span class="string">&quot;test&quot;</span>: <span class="string">&quot;craco test&quot;</span>,</span><br><span class="line">    <span class="string">&quot;eject&quot;</span>: <span class="string">&quot;react-scripts eject&quot;</span>,</span><br><span class="line">    <span class="string">&quot;anylyze&quot;</span>: <span class="string">&quot;source-map-explorer &#x27;build/static/js/*.js&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line">yarn anylyze</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="路由懒加载"><a href="#路由懒加载" class="headerlink" title="路由懒加载"></a>路由懒加载</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入 lazy 和 Suspense 需要配合使用</span></span><br><span class="line"><span class="keyword">import</span> &#123; lazy, <span class="title class_">Suspense</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="comment">// 正常导入页面</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Layout</span> <span class="keyword">from</span> <span class="string">&#x27;@/pages/Layout&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Login</span> <span class="keyword">from</span> <span class="string">&#x27;./pages/Login&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">NotFound</span> <span class="keyword">from</span> <span class="string">&#x27;./pages/NotFound&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 懒加载导入,</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Layout</span> = <span class="title function_">lazy</span>(<span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;@/pages/Layout&#x27;</span>))</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Login</span> = <span class="title function_">lazy</span>(<span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;./pages/Login&#x27;</span>))</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">NotFound</span> = <span class="title function_">lazy</span>(<span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;./pages/NotFound&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// Suspense组件需要将把懒加载的组件包裹在里面</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Router</span> <span class="attr">history</span>=<span class="string">&#123;customHistroy&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;/* 使用Suspense 包裹所有内容 */&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Suspense</span> <span class="attr">fallback</span>=<span class="string">&quot;loading...&quot;</span>&gt;</span>	//fallback可以写jsx代码，可以使用组件制作loding效果</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Switch</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/&quot;</span> <span class="attr">exact</span> <span class="attr">render</span>=<span class="string">&#123;()</span> =&gt;</span> <span class="tag">&lt;<span class="name">Redirect</span> <span class="attr">to</span>=<span class="string">&quot;/home&quot;</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">AuthRoute</span> <span class="attr">path</span>=<span class="string">&quot;/home&quot;</span> <span class="attr">component</span>=<span class="string">&#123;Layout&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/login&quot;</span> <span class="attr">component</span>=<span class="string">&#123;Login&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;/* 404 */&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Route</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">NotFound</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">Switch</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Suspense</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Router</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="配置CDN（内容分发网络）"><a href="#配置CDN（内容分发网络）" class="headerlink" title="配置CDN（内容分发网络）"></a>配置CDN（内容分发网络）</h3><p>通过 craco 来修改webpack配置，从而实现CDN优化</p>
<p><a target="_blank" rel="noopener" href="https://craco.js.org/docs/configuration/webpack/">craco文档地址</a></p>
<p><a target="_blank" rel="noopener" href="https://webpack.docschina.org/configuration/externals/">外部扩展(Externals)</a></p>
<p>安装 craco</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yarn add  @craco/craco</span><br><span class="line"><span class="comment">//或者</span></span><br><span class="line"> npm install  @craco/craco --save</span><br></pre></td></tr></table></figure>

<p>在项目 根目录新建craco.config.js文件</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; whenProd, getPlugin, pluginByName &#125; = <span class="built_in">require</span>(<span class="string">&#x27;@craco/craco&#x27;</span>)</span><br><span class="line"><span class="comment">// whenProd =&gt; when production 针对生产环境做处理</span></span><br><span class="line"><span class="comment">// whenProd()第一个参数，在生产环境中，第二个参数，默认值</span></span><br><span class="line"><span class="comment">// whenProd(() =&gt; &#123;&#125;,[])</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// webpack配置</span></span><br><span class="line">  <span class="attr">webpack</span>: &#123;</span><br><span class="line">    <span class="comment">// 配置别名</span></span><br><span class="line">    <span class="attr">alias</span>: &#123;</span><br><span class="line">      <span class="comment">// 约定:使用 @ 表示 src 文件所在路径</span></span><br><span class="line">      <span class="string">&#x27;@&#x27;</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;src&#x27;</span>),</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">configure</span>: <span class="function">(<span class="params">webpackConfig</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 生产环境下，配置 externals</span></span><br><span class="line">      webpackConfig.<span class="property">externals</span> = <span class="title function_">whenProd</span>(</span><br><span class="line">        <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">          <span class="attr">react</span>: <span class="string">&#x27;React&#x27;</span>,</span><br><span class="line">          <span class="string">&#x27;react-dom&#x27;</span>: <span class="string">&#x27;ReactDOM&#x27;</span>,</span><br><span class="line">          <span class="attr">redux</span>: <span class="string">&#x27;Redux&#x27;</span>,</span><br><span class="line">          <span class="string">&#x27;react-router-dom&#x27;</span>: <span class="string">&#x27;ReactRouterDOM&#x27;</span>,</span><br><span class="line">        &#125;),</span><br><span class="line">        &#123;&#125;</span><br><span class="line">      )</span><br><span class="line">      <span class="comment">// 拿到 HtmlWebpackPlugin 插件</span></span><br><span class="line">      <span class="keyword">const</span> &#123; isFound, match &#125; = <span class="title function_">getPlugin</span>(</span><br><span class="line">        webpackConfig,</span><br><span class="line">        <span class="title function_">pluginByName</span>(<span class="string">&#x27;HtmlWebpackPlugin&#x27;</span>)</span><br><span class="line">      )</span><br><span class="line">      <span class="comment">// 生产环境下，暴露 CDN 链接到模板页面中</span></span><br><span class="line">      <span class="keyword">if</span> (isFound) &#123;</span><br><span class="line">        <span class="comment">// match 表示当前匹配的插件 HtmlWebpackPlugin</span></span><br><span class="line">        <span class="comment">// 通过 options 将额外的数据添加给 HtmlWebpackPlugin 插件</span></span><br><span class="line">        <span class="comment">// options可以传递任意数据，比如，此处我们自己写的 cdn 就是要额外传递的数据</span></span><br><span class="line">        match.<span class="property">options</span>.<span class="property">cdn</span> = &#123;</span><br><span class="line">          <span class="comment">// js 链接</span></span><br><span class="line">          <span class="attr">js</span>: <span class="title function_">whenProd</span>(</span><br><span class="line">            <span class="function">() =&gt;</span> [</span><br><span class="line">              <span class="string">&#x27;https://cdn.bootcdn.net/ajax/libs/react/18.2.0/cjs/react-jsx-dev-runtime.production.min.js&#x27;</span>,</span><br><span class="line">              <span class="string">&#x27;https://cdn.bootcdn.net/ajax/libs/react-dom/18.2.0/cjs/react-dom-server-legacy.browser.production.min.js&#x27;</span>,</span><br><span class="line">              <span class="string">&#x27;https://cdn.bootcdn.net/ajax/libs/redux/4.2.1/redux.min.js&#x27;</span>,</span><br><span class="line">              <span class="string">&#x27;https://cdn.bootcdn.net/ajax/libs/react-router-dom/6.10.0/react-router-dom.production.min.js&#x27;</span>,</span><br><span class="line">            ],</span><br><span class="line">            []</span><br><span class="line">          ),</span><br><span class="line">          <span class="comment">// css 链接</span></span><br><span class="line">          <span class="attr">css</span>: [],</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> webpackConfig</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>public&#x2F;index.html中：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">	</span><br><span class="line"> &lt;div id=<span class="string">&quot;root&quot;</span>&gt;&lt;/div&gt;</span><br><span class="line">      &lt;!-- 加载第三方包的 <span class="variable constant_">CDN</span>链接 --&gt;</span><br><span class="line">      &lt;% htmlWebpackPlugin.<span class="property">options</span>.<span class="property">cdn</span>.<span class="property">js</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">cdnURL</span> =&gt;</span> &#123; %&gt;</span><br><span class="line">      	<span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;&lt;%= cdnURL %&gt;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">      &lt;% &#125;) %&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>

<h3 id="查找项目中对应的CDN"><a href="#查找项目中对应的CDN" class="headerlink" title="查找项目中对应的CDN"></a>查找项目中对应的CDN</h3><p><a href="unpkg.com">unpkg</a><br><a href="bootcdn.cn">bootcdn</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/04/08/%E7%BB%84%E4%BB%B6%E5%A4%8D%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="柯建军">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="柯建军的博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 柯建军的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/04/08/%E7%BB%84%E4%BB%B6%E5%A4%8D%E7%94%A8/" class="post-title-link" itemprop="url">组件复用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2023-04-08 16:40:53 / 修改时间：17:36:36" itemprop="dateCreated datePublished" datetime="2023-04-08T16:40:53+08:00">2023-04-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/React/" itemprop="url" rel="index"><span itemprop="name">React</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2.3k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="组件复用"><a href="#组件复用" class="headerlink" title="组件复用"></a>组件复用</h2><h3 id="antd-组件复用示例"><a href="#antd-组件复用示例" class="headerlink" title="antd 组件复用示例"></a>antd 组件复用示例</h3><p>如图所示，在内容管理路由组件和发布文章组件都有Select选择器</p>
<p><img src="/2023/04/08/%E7%BB%84%E4%BB%B6%E5%A4%8D%E7%94%A8/1.png" alt="1"></p>
<p><img src="/2023/04/08/%E7%BB%84%E4%BB%B6%E5%A4%8D%E7%94%A8/2.png" alt="2"></p>
<p>将该功能单独封装成组件，复用的组件应当完善和健壮。<br>这个组件是From表单的受控组件。<br>antd的自定义表单控件的说明<a target="_blank" rel="noopener" href="https://ant.design/components/form-cn#components-form-demo-customized-form-controls">From</a><br>说明：<br>自定义或第三方的表单控件，也可以与 Form 组件一起使用。只要该组件遵循以下的约定：<br>1.提供受控属性 value 或其它与 valuePropName 的值同名的属性<br>2.提供 onChange 事件或 trigger 的值同名的事件。</p>
<p>From表单</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pages/Article/index.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Channels</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@/components/Channels&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Article</span>(<span class="params"></span>) &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">return</span>(</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">Form</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Form.Item</span> <span class="attr">label</span>=<span class="string">&quot;频道：&quot;</span> <span class="attr">name</span>=<span class="string">&quot;channel_id&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">Channels</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Form</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>复用的组件</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// components/Channels</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Select</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useDispatch, useSelector &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; getChannels &#125; <span class="keyword">from</span> <span class="string">&#x27;@/store/actions&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//不是受控组件</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">Channels</span> = (<span class="params">&#123; ...rest &#125;</span>) =&gt; &#123;		<span class="comment">// 接收到表单的参数</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(rest)		<span class="comment">// &#123;value: undefined, id: &#x27;channel_id&#x27;, onChange: ƒ&#125;	更换频道也拿不到当前值</span></span><br><span class="line">  <span class="keyword">const</span> dispatch = <span class="title function_">useDispatch</span>()</span><br><span class="line">  <span class="keyword">const</span> &#123; channels &#125; = <span class="title function_">useSelector</span>(<span class="function">(<span class="params">value</span>) =&gt;</span> value.<span class="property">article</span>)</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">dispatch</span>(<span class="title function_">getChannels</span>())		<span class="comment">//分发获取参数的状态</span></span><br><span class="line">  &#125;, [dispatch])</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Select</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">placeholder</span>=<span class="string">&quot;请选择文章频道&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    &gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;channels.map((items) =&gt; (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Select.Option</span> <span class="attr">key</span>=<span class="string">&#123;items.id&#125;</span> <span class="attr">value</span>=<span class="string">&#123;items.id&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;items.name&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Select.Option</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      ))&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Select</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 改为受控组件，给Select组件添加value，onChange属性,width是自定义参数，可以自定义样式</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">Channels</span> = (<span class="params">&#123; value,onChange,width &#125;</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> dispatch = <span class="title function_">useDispatch</span>()</span><br><span class="line">  <span class="keyword">const</span> &#123; channels &#125; = <span class="title function_">useSelector</span>(<span class="function">(<span class="params">value</span>) =&gt;</span> value.<span class="property">article</span>)</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">dispatch</span>(<span class="title function_">getChannels</span>())</span><br><span class="line">  &#125;, [dispatch])</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Select</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">style</span>=<span class="string">&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        &#123;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">width</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      &#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">placeholder</span>=<span class="string">&quot;请选择文章频道&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">value</span>=<span class="string">&#123;value&#125;</span>		// 指定当前选中的条目</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">onChange</span>=<span class="string">&#123;onChange&#125;</span>	//选中 <span class="attr">option</span>，或 <span class="attr">input</span> 的 <span class="attr">value</span> 变化时，调用此函数</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    &gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;channels.map((items) =&gt; (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Select.Option</span> <span class="attr">key</span>=<span class="string">&#123;items.id&#125;</span> <span class="attr">value</span>=<span class="string">&#123;items.id&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;items.name&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Select.Option</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      ))&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Select</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>最后在两个路由组件引入组件就行了</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Channels</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@/components/Channels&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Article</span>(<span class="params"></span>) &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">return</span>(</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">Form</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Form.Item</span> <span class="attr">label</span>=<span class="string">&quot;频道：&quot;</span> <span class="attr">name</span>=<span class="string">&quot;channel_id&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">Channels</span> <span class="attr">width</span>=<span class="string">&#123;xxx&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Form</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/03/31/%E8%B7%AF%E7%94%B1%E9%89%B4%E6%9D%83%E5%92%8C%E8%B7%AF%E7%94%B1%E9%87%8D%E5%AE%9A%E5%90%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="柯建军">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="柯建军的博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 柯建军的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/03/31/%E8%B7%AF%E7%94%B1%E9%89%B4%E6%9D%83%E5%92%8C%E8%B7%AF%E7%94%B1%E9%87%8D%E5%AE%9A%E5%90%91/" class="post-title-link" itemprop="url">路由鉴权和路由重定向</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2023-03-31 21:55:11 / 修改时间：22:45:33" itemprop="dateCreated datePublished" datetime="2023-03-31T21:55:11+08:00">2023-03-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/React/" itemprop="url" rel="index"><span itemprop="name">React</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="路由鉴权"><a href="#路由鉴权" class="headerlink" title="路由鉴权"></a>路由鉴权</h2><p>路由鉴权是项目中必不可少的操作，目的是确认用户是否有权限访问某个路由，例如，用户未拿到token时,就只能访问到登录路由。<br>自己封装一个 <Route/>路由组件实现路由鉴权</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// App.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AuthRoute</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./components/AuthRoute&#x27;</span></span><br><span class="line">&lt;<span class="title class_">Router</span>&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Switch</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;/* <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/home&quot;</span> <span class="attr">component</span>=<span class="string">&#123;Layout&#125;</span> /&gt;</span> */&#125;</span></span><br><span class="line"><span class="language-xml">        &#123;/* 自己封装路由组件 */&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">AuthRoute</span> <span class="attr">path</span>=<span class="string">&quot;/home&quot;</span> <span class="attr">component</span>=<span class="string">&#123;Layout&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">	<span class="tag">&lt;/<span class="name">Switch</span>&gt;</span></span></span><br><span class="line">&lt;/<span class="title class_">Router</span>&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// components/AuthRoute.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Route</span>, <span class="title class_">Redirect</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span>	</span><br><span class="line"><span class="comment">// 为utils下所有模块统一暴露</span></span><br><span class="line"><span class="keyword">import</span> &#123; isTOken &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils&#x27;</span>	<span class="comment">//isTOken函数返回一个布尔值，确认localStorage是否存有token  const isTOken = () =&gt; Boolean(getToken())</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//接收到路由组件的传参，解构除了component属性的剩余参数,  conponent重命名</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">AuthRoute</span> = (<span class="params">&#123; component: Component, ...rest &#125;</span>) =&gt; &#123;	</span><br><span class="line">  <span class="comment">// console.log(rest)</span></span><br><span class="line">  <span class="keyword">return</span> (		<span class="comment">// 返回一个&lt;Route/&gt;</span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Route</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      &#123;<span class="attr">...rest</span>&#125;		//将接收到的参数再传给&lt;<span class="attr">Route</span>/&gt;</span>组件</span></span><br><span class="line"><span class="language-xml">      render=&#123;(props) =&gt;	//render的回调函数，按条件渲染一个路由组件，传入props参数</span></span><br><span class="line"><span class="language-xml">        isTOken() ? (		// 判断是否有token</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Component</span> /&gt;</span>		// 有token，正常渲染路由组件</span></span><br><span class="line"><span class="language-xml">        ) : (</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Redirect</span>			// 无<span class="attr">token</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">to</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">pathname:</span> &#x27;/<span class="attr">login</span>&#x27;,	// 重定向到<span class="attr">login</span>组件</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">state:</span> &#123; <span class="attr">from:</span> <span class="attr">props.location.pathname</span> &#125;,		// 向路由组件传递<span class="attr">state</span>参数，<span class="attr">props.location.pathname</span> 为当前路由组件路径</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          /&gt;</span></span></span><br><span class="line"><span class="language-xml">        )</span></span><br><span class="line"><span class="language-xml">      &#125;</span></span><br><span class="line"><span class="language-xml">    /&gt;</span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="未登录时重定向到登录页面后返回原来页面"><a href="#未登录时重定向到登录页面后返回原来页面" class="headerlink" title="未登录时重定向到登录页面后返回原来页面"></a>未登录时重定向到登录页面后返回原来页面</h2><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pages/Login/login.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; useHistory, useLocation &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Login</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> dispatch = <span class="title function_">useDispatch</span>()</span><br><span class="line">  <span class="keyword">const</span> history = <span class="title function_">useHistory</span>()</span><br><span class="line">  <span class="keyword">const</span> location = <span class="title function_">useLocation</span>()</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">onFinish</span> = <span class="keyword">async</span> (<span class="params">values</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="title function_">dispatch</span>(<span class="title function_">login</span>(&#123; <span class="attr">mobile</span>: values.<span class="property">mobile</span>, <span class="attr">code</span>: values.<span class="property">code</span> &#125;))</span><br><span class="line">      message.<span class="title function_">success</span>(<span class="string">&#x27;登录成功！&#x27;</span>, <span class="number">1.5</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">//根据路由地址跳转页面，location?.state?.from的值要么是原来页面的路由，要么为undefined，当左侧操作符为 undefined和null时，?? 执行右侧操作数</span></span><br><span class="line">        history.<span class="title function_">replace</span>(location?.<span class="property">state</span>?.<span class="property">from</span> ?? <span class="string">&#x27;/home&#x27;</span>)		</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      message.<span class="title function_">warning</span>(</span><br><span class="line">        e.<span class="property">response</span></span><br><span class="line">          ? e.<span class="property">response</span>?.<span class="property">data</span>?.<span class="property">message</span> ?? <span class="string">&#x27;出错了~&#x27;</span></span><br><span class="line">          : <span class="string">&#x27;网络繁忙，请稍后再试&#x27;</span>,</span><br><span class="line">        <span class="number">1.5</span></span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (...)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/03/27/redux%E5%92%8CReact-redux/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="柯建军">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="柯建军的博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 柯建军的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/03/27/redux%E5%92%8CReact-redux/" class="post-title-link" itemprop="url">redux和React-redux</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-03-27 22:38:12" itemprop="dateCreated datePublished" datetime="2023-03-27T22:38:12+08:00">2023-03-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-04-01 22:04:16" itemprop="dateModified" datetime="2023-04-01T22:04:16+08:00">2023-04-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/React/" itemprop="url" rel="index"><span itemprop="name">React</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>5.8k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>5 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="redux"><a href="#redux" class="headerlink" title="redux"></a>redux</h2><p>Redux 是 JavaScript 状态容器，提供可预测化的状态管理。<a target="_blank" rel="noopener" href="https://www.redux.org.cn/">官网</a><br>安装redux</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install --save redux</span><br><span class="line">或</span><br><span class="line">yarn add redux</span><br></pre></td></tr></table></figure>
<h2 id="redux三大核心属性"><a href="#redux三大核心属性" class="headerlink" title="redux三大核心属性"></a>redux三大核心属性</h2><h3 id="action"><a href="#action" class="headerlink" title="action"></a>action</h3><p><code>Action</code> 本质上是 JavaScript 普通<code>对象</code>。我们约定，action 内必须使用一个字符串类型的 <code>type</code> 字段来表示将要执行的动作。多数情况下，type 会被定义成字符串常量。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义了一个add函数，函数返回一个action对象</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">add</span> = (<span class="params">payload</span>) =&gt; (&#123; <span class="attr">type</span>: <span class="string">&#x27;add&#x27;</span>, payload &#125;)</span><br></pre></td></tr></table></figure>
<h3 id="reducer"><a href="#reducer" class="headerlink" title="reducer"></a>reducer</h3><p><code>reducer</code> 就是一个<code>纯函数</code>，接收旧的 state 和 action，返回新的 state。<br>注意 reducer 是纯函数。它仅仅用于计算下一个 state。它应该是完全可预测的：多次传入相同的输入必须产生相同的输出。它不应做有副作用的操作，如 API 调用或路由跳转。这些应该在 dispatch action 前发生。<br>下面代码就是reducer接收了一个旧的state和action，返回了新的state</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">reducer</span> = (<span class="params">state, action</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.<span class="property">type</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;add&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> (state = state + action.<span class="property">payload</span>)</span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">reducer</span>(<span class="number">0</span>,<span class="title function_">add</span>(<span class="number">1</span>))</span><br><span class="line"><span class="comment">// 等价于</span></span><br><span class="line"><span class="comment">// reducer(0,&#123; type: &#x27;add&#x27;, payload:1 &#125;)</span></span><br></pre></td></tr></table></figure>

<h3 id="store"><a href="#store" class="headerlink" title="store"></a>store</h3><p>在前面的代码中，我们学会了使用 action 来描述“发生了什么”，和使用 reducers 来根据 action 更新 state 的用法。<br><code>Store</code> 就是把它们联系到一起的<code>对象</code>。Store 有以下职责：<br>维持应用的 state；<br>提供 getState() 方法获取 state；<br>提供 dispatch(action) 方法更新 state；<br>通过 subscribe(listener) 注册监听器;<br>通过 subscribe(listener) 返回的函数注销监听器。<br>再次强调一下 Redux 应用只有一个<code>单一</code>的 store。当需要拆分数据处理逻辑时，你应该使用 reducer 组合 而不是创建多个 store。<br>根据已有的 reducer 来创建 store</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; configureStore &#125; <span class="keyword">from</span> <span class="string">&#x27;@reduxjs/toolkit&#x27;</span></span><br><span class="line"><span class="comment">// action</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Add</span> = (<span class="params">payload</span>) =&gt; (&#123; <span class="attr">type</span>: <span class="string">&#x27;add&#x27;</span>, payload &#125;)</span><br><span class="line"><span class="comment">// reducer</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">reducer</span> = (<span class="params">state = <span class="number">0</span>, action</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.<span class="property">type</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;add&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> state + action.<span class="property">payload</span></span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 创建一个store实例</span></span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">configureStore</span>(&#123; reducer &#125;)</span><br><span class="line"><span class="comment">// 每次state更新时,打印日志,getState,获取最新state</span></span><br><span class="line"><span class="comment">// 返回一个函数来注销监听器</span></span><br><span class="line"><span class="keyword">const</span> unsubscribe = store.<span class="title function_">subscribe</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;state:&#x27;</span>,store.<span class="title function_">getState</span>()))   <span class="comment">//1  3</span></span><br><span class="line"><span class="comment">// dispatch，更新state</span></span><br><span class="line">store.<span class="title function_">dispatch</span>(<span class="title class_">Add</span>(<span class="number">1</span>))</span><br><span class="line">store.<span class="title function_">dispatch</span>(<span class="title class_">Add</span>(<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 停止监听state更新</span></span><br><span class="line"><span class="title function_">unsubscribe</span>()</span><br></pre></td></tr></table></figure>
<h3 id="configureStore"><a href="#configureStore" class="headerlink" title="configureStore"></a>configureStore</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// configureStore是用来替代createStore方法</span></span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">configureStore</span>(&#123;</span><br><span class="line"><span class="attr">reducer</span>:xxx,	</span><br><span class="line">preloadedState：xxx,		<span class="comment">//初始化状态</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="Redux获取状态默认值的执行过程"><a href="#Redux获取状态默认值的执行过程" class="headerlink" title="Redux获取状态默认值的执行过程"></a>Redux获取状态默认值的执行过程</h3><p>只要创建store，那么，Redux就会调用一次 reducer</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// action</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Add</span> = (<span class="params">payload</span>) =&gt; (&#123; <span class="attr">type</span>: <span class="string">&#x27;add&#x27;</span>, payload &#125;)</span><br><span class="line"><span class="comment">// reducer</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">reducer</span> = (<span class="params">state, action</span>) =&gt; &#123;		<span class="comment">// 这里没有给 state赋值，所以返回undefined.可以这样给state赋值：state = 0</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;reducer&#x27;</span>,state,action);		<span class="comment">//reducer undefined &#123;type: &#x27;@@redux/INITr.5.x.p.5&#x27;&#125;</span></span><br><span class="line">  <span class="keyword">switch</span> (action.<span class="property">type</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;add&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> state + action.<span class="property">payload</span></span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// store</span></span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">configureStore</span>(&#123;reducer&#125;)		<span class="comment">// 只要创建了store，redux就会调用一次reducer</span></span><br></pre></td></tr></table></figure>
<p>这一次调用renucer的目的：获取状态的默认值，<br>第一次调用reducer时，redux机制会让action.type的value是一个随机的字符串，以确保return的是state<br>redux内部第一次调用reducer:</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reducer <span class="literal">undefined</span> &#123;<span class="attr">type</span>: <span class="string">&#x27;@@redux/INITr.5.x.p.5&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>

<h3 id="redux数据流"><a href="#redux数据流" class="headerlink" title="redux数据流"></a>redux数据流</h3><p>严格的单向数据流是 Redux 架构的设计核心。<br>这意味着应用中所有的数据都遵循相同的生命周期，这样可以让应用变得更加可预测且容易理解。同时也鼓励做数据范式化，这样可以避免使用多个且独立的无法相互引用的重复数据。</p>
<h2 id="React-redux"><a href="#React-redux" class="headerlink" title="React-redux"></a>React-redux</h2><h3 id="Provider"><a href="#Provider" class="headerlink" title="Provider"></a>Provider</h3><p>在项目入口文件，一般是src目录下的index.js，为整个项目(App组件)提供redux状态管理</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">ReactDOM</span> <span class="keyword">from</span> <span class="string">&#x27;react-dom/client&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Provider</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App&#x27;</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;./store&#x27;</span></span><br><span class="line"><span class="keyword">const</span> root = <span class="title class_">ReactDOM</span>.<span class="title function_">createRoot</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;root&#x27;</span>))</span><br><span class="line">root.<span class="title function_">render</span>(</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Provider</span> <span class="attr">store</span>=<span class="string">&#123;store&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">App</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">Provider</span>&gt;</span></span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="完整示例"><a href="#完整示例" class="headerlink" title="完整示例"></a>完整示例</h3><p>获取个人信息的示例，完整的展示了redux的使用</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 在pages/Layout/index.js中，分发获取个人信息的异步action</span></span><br><span class="line"><span class="keyword">import</span> &#123; useDispatch, useSelector &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span>		<span class="comment">//useDispatch用来分发一个action</span></span><br><span class="line"><span class="keyword">import</span> &#123; getUserInfo &#125; <span class="keyword">from</span> <span class="string">&#x27;@/store/actions&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">GeekLayout</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> dispatch = <span class="title function_">useDispatch</span>()</span><br><span class="line">    <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">dispatch</span>(<span class="title function_">getUserInfo</span>())		<span class="comment">// 这里的函数由actions组件提供，根据接口所需要的数据，来决定getUserInfo()要不要填入实参</span></span><br><span class="line">    &#125;, [dispatch])		</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">return</span>(</span><br><span class="line">    	...</span><br><span class="line">        &#123;name&#125;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2. 在 store/actions/user.js中，创建异步action并获取个人信息</span></span><br><span class="line"><span class="keyword">import</span> &#123; http &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils&#x27;</span>				<span class="comment">// 封装了axios，简写了请求地址</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getUserInfo</span> = (<span class="params"></span>) =&gt; &#123;			<span class="comment">// 异步action可以是一个函数，也可以是一个对象，同步action只能是一个对象</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">async</span> (dispatch, getState) =&gt; &#123;	<span class="comment">// dispatch, getState是由thunk中间件提供的参数</span></span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">login</span>: token &#125; = <span class="title function_">getState</span>()		<span class="comment">// getState是一个函数，返回redux中存储的状态，这里解构拿到了login对象的值，重命名为token</span></span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> http.<span class="title function_">get</span>(<span class="string">&#x27;/v1_0/user/profile&#x27;</span>, &#123;</span><br><span class="line">      <span class="attr">headers</span>: &#123;</span><br><span class="line">        <span class="title class_">Authorization</span>: <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span>,	<span class="comment">// 传入个人信息所需要提供的token</span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// 3.将接口返回的信息 dispatch到reducer来存储该状态</span></span><br><span class="line">    <span class="title function_">dispatch</span>(&#123; <span class="attr">type</span>: <span class="string">&#x27;user/userInfo&#x27;</span>, <span class="attr">payload</span>: res.<span class="property">data</span>.<span class="property">data</span> &#125;)		</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 4. 在 store/reducers/user.js中，处理个人信息的action，将状态存储到redux中</span></span><br><span class="line"><span class="keyword">const</span> initialState = &#123;&#125;		<span class="comment">// 因为个人信息状态是一个对象，所以默认状态为一个对象</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">user</span> = (<span class="params">state = initialState, action</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.<span class="property">type</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;user/userInfo&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> action.<span class="property">payload</span></span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 5. 在pages/Layout/index.js中，获取个人信息并展示</span></span><br><span class="line"><span class="keyword">import</span> &#123; useDispatch, useSelector &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span>		</span><br><span class="line"><span class="keyword">import</span> &#123; getUserInfo &#125; <span class="keyword">from</span> <span class="string">&#x27;@/store/actions&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">GeekLayout</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> dispatch = <span class="title function_">useDispatch</span>()</span><br><span class="line">    <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">dispatch</span>(<span class="title function_">getUserInfo</span>())	</span><br><span class="line">    &#125;, [dispatch])</span><br><span class="line">    <span class="comment">// 拿到redux中的状态</span></span><br><span class="line">  	<span class="keyword">const</span> &#123; name &#125; = <span class="title function_">useSelector</span>(<span class="function">(<span class="params">state</span>) =&gt;</span> state.<span class="property">user</span>)</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">return</span>(</span><br><span class="line">    	...</span><br><span class="line">        &#123;name&#125;		<span class="comment">// 渲染状态</span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="reducer的分离与合并"><a href="#reducer的分离与合并" class="headerlink" title="reducer的分离与合并"></a>reducer的分离与合并</h3><p><strong>根 reducer 应该把多个子 reducer 输出合并成一个单一的 state 树。</strong></p>
<p>根 reducer 的结构完全由你决定。Redux 原生提供<a target="_blank" rel="noopener" href="https://www.redux.org.cn/docs/api/combineReducers.html"><code>combineReducers()</code></a>辅助函数，来把根 reducer 拆分成多个函数，用于分别处理 state 树的一个分支。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;combineReducers&#125; <span class="keyword">from</span> <span class="string">&#x27;redux&#x27;</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">todos</span>(<span class="params">state = [], action</span>) &#123;</span><br><span class="line">   <span class="comment">// 省略处理逻辑...</span></span><br><span class="line">   <span class="keyword">return</span> nextState</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">function</span> <span class="title function_">visibleTodoFilter</span>(<span class="params">state = <span class="string">&#x27;SHOW_ALL&#x27;</span>, action</span>) &#123;</span><br><span class="line">   <span class="comment">// 省略处理逻辑...</span></span><br><span class="line">   <span class="keyword">return</span> nextState</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将多个reducer合并根reducer</span></span><br><span class="line"> <span class="keyword">let</span> todoApp = <span class="title function_">combineReducers</span>(&#123;</span><br><span class="line">   todos,</span><br><span class="line">   visibleTodoFilter</span><br><span class="line"> &#125;)</span><br></pre></td></tr></table></figure>

<p>当你触发 action 后，<code>combineReducers</code> 返回的 <code>todoApp</code> 会负责调用两个 reducer：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> nextTodos = <span class="title function_">todos</span>(state.<span class="property">todos</span>, action)</span><br><span class="line"><span class="keyword">let</span> nextVisibleTodoFilter = <span class="title function_">visibleTodoFilter</span>(state.<span class="property">visibleTodoFilter</span>, action)</span><br></pre></td></tr></table></figure>

<p>然后会把两个结果集合并成一个 state 树：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line">  <span class="attr">todos</span>: nextTodos,</span><br><span class="line">  <span class="attr">visibleTodoFilter</span>: nextVisibleTodoFilter</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="action-type-or-constants"><a href="#action-type-or-constants" class="headerlink" title="action type or constants"></a>action type or constants</h3><p>为了解决action和reducer中字符串误写错和命名冲突，建议单独抽离放在 actiontypes或constants目录中,一般放在store目录下<br>目录结构</p>
<p>|– store<br>           |– actions		负责对应组件的action<br>           |– actiontypes		抽离字符串<br>           |– reducers		负责对应组件的reducer<br>           |– index.js	入口文件，创建唯一的store</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// actiontypes目录</span></span><br><span class="line"><span class="keyword">const</span> add = <span class="string">&#x27;counter/add&#x27;</span></span><br><span class="line"><span class="keyword">const</span> sub = <span class="string">&#x27;counter/sub&#x27;</span></span><br><span class="line"><span class="keyword">export</span> &#123; add, sub &#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/03/27/Context/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="柯建军">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="柯建军的博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 柯建军的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/03/27/Context/" class="post-title-link" itemprop="url">Context</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2023-03-27 12:27:54 / 修改时间：13:33:44" itemprop="dateCreated datePublished" datetime="2023-03-27T12:27:54+08:00">2023-03-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/React/" itemprop="url" rel="index"><span itemprop="name">React</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>676</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="提供者与消费者模式"><a href="#提供者与消费者模式" class="headerlink" title="提供者与消费者模式"></a>提供者与消费者模式</h2><p>用于组孙组件通讯的场景</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState, createContext, useContext &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="comment">// createContext使用方式</span></span><br><span class="line"><span class="keyword">const</span> context = <span class="title function_">createContext</span>()		<span class="comment">//createContext可以提供默认值，只有在没有 Provider时生效</span></span><br><span class="line"><span class="keyword">const</span> </span><br><span class="line"><span class="comment">// 祖先组件提供数据 关键字： Provider</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">parent</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span>(</span><br><span class="line">    	<span class="language-xml"><span class="tag">&lt;<span class="name">context.Provider</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">value</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">color</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">setColor</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        &gt;</span></span></span><br><span class="line"><span class="language-xml">        ...</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">context.Provider</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 后代组件消费</span></span><br><span class="line"><span class="comment">// 1.使用 Consumer</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Child</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span>(</span><br><span class="line">    	<span class="language-xml"><span class="tag">&lt;<span class="name">context.Consumer</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;/*以函数传参形式消费*/&#125;</span></span><br><span class="line"><span class="language-xml">            &#123; value =&gt; ... &#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">context.Consumer</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 使用 useContext</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Child</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> value = <span class="title function_">useContext</span>(context)</span><br><span class="line">    <span class="keyword">return</span>() &#123;</span><br><span class="line">        &#123;value.<span class="property">xxx</span>&#125;...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">柯建军</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">93k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">1:24</span>
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  





  





</body>
</html>
